## Commands
This section lists command(s) run by bamToFastq workflow

* Running bamToFastq

bamToFastq generates R1 and R2 fastqs for BAM files with one or more readgroups.

### Extract readgroup and flagstatinfo from bam file
Readgroup information is needed to rename files.  Flagstat information is provided for comparison to the fastq ouput.

```
samtools flagstat ~{bamFile} > ~{prefix}.flagstat.txt
samtools stats ~{bamFile} > ~{prefix}.samstats.txt
samtools view -H ~{bamFile} | grep -G "^@RG" > ~{prefix}.readgroups.tsv

```

### Verify that fields in the requested naming scheme are found in the bam file.
By default, the fastqs are named using the read IDs. To modify names, readgroup fields can be indicated to use their values, mixing with text strings. The input parameter fileNaming should be formatted like this:

```
"{tag1}_{tag2}_text"
eg.
"{PU}_{PL}". -> {PU}_{PL}_Rn.fastq.gz
"{LB}_{PU}_test01" -> {LB}_{PU}_test01_Rn.fastq.gz

where Rn is the read number (R1, R2)
```

The file naming scheme will be declared invalid if:
- It results in non-unique file names
- It contains an invalid RG tag

One should inspect the bam header readgroups prior to choosing a naming scheme.

```
inline python code for assessing fileNaming request available in the WDL file

```


### Sort the bam file by readname to remove any by-mapping-position ordering of reads
```
   samtools sort -n ~{bamFileToSort} -O bam -o unsorted.bam
```



### Backextract fastq files from bam file per readgroup.
```
java -Xmx20g -jar $PICARD_ROOT/picard.jar SamToFastq \
     INPUT=~{bamFile} \
     RG_TAG="ID" \
     OUTPUT_DIR=. \
     OUTPUT_PER_RG=true \
     COMPRESS_OUTPUTS_PER_RG=true \
     NON_PF=true \
     RE_REVERSE=true \
     VALIDATION_STRINGENCY=LENIENT

```

### Rename fastqs based on naming scheme.
the default naming scheme is to use the RG IDs.  If an alternate naming pattern was provided then files will be renamed

```
inline python code to rename files available in the WDL file

```


### Generate fastqc reports for each fastq file

```
 fastqc ~{fastq}

```

